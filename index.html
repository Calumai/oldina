<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2/21 ä¸–ç•Œæ¯èªæ—¥ - æ”¤ä½äº’å‹•ä¸»æ§å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0fdf4; }
        .btn-push { transition: all 0.1s; box-shadow: 0 4px 0 #b91c1c; }
        .btn-push:active { transform: translateY(4px); box-shadow: 0 0 0 #b91c1c; }
        .flag-btn { height: 150px; border-radius: 20px; font-size: 2rem; font-weight: bold; transition: transform 0.2s; }
        .flag-btn:active { transform: scale(0.95); }
    </style>
</head>
<body class="h-screen overflow-hidden text-slate-800">

<div id="app" class="h-full flex flex-col">

    <div v-if="view === 'home'" class="flex-1 flex flex-col items-center justify-center space-y-8 bg-gradient-to-br from-green-400 to-blue-500 text-white">
        <h1 class="text-5xl font-black mb-4 animate__animated animate__bounceIn">æ”¤ä½äº’å‹•ä¸»æ§å°</h1>
        <p class="text-xl opacity-90">2/21 ä¸–ç•Œæ¯èªæ—¥å°ˆç”¨</p>
        <div class="flex space-x-8 mt-8">
            <button @click="enterRole('admin')" class="bg-white text-blue-600 px-8 py-6 rounded-2xl shadow-xl text-2xl font-bold hover:scale-105 transition transform">
                ğŸ‘¨â€ğŸ« æˆ‘æ˜¯é—œä¸»<br><span class="text-sm font-normal text-gray-500">(é›»è…¦/å¤§è¢å¹•ç«¯)</span>
            </button>
            <button @click="enterRole('client')" class="bg-white text-green-600 px-8 py-6 rounded-2xl shadow-xl text-2xl font-bold hover:scale-105 transition transform">
                ğŸ™‹â€â™‚ï¸ æˆ‘æ˜¯å­¸ç”Ÿ<br><span class="text-sm font-normal text-gray-500">(æ‰‹æ©Ÿ/å¹³æ¿ç«¯)</span>
            </button>
        </div>
    </div>

    <div v-if="view === 'admin'" class="h-full flex">
        <div class="w-1/4 bg-slate-800 text-white p-6 flex flex-col space-y-6">
            <h2 class="text-2xl font-bold text-yellow-400">ğŸ® æ§åˆ¶ä¸­å¿ƒ</h2>
            
            <div class="space-y-4">
                <p class="text-gray-400 text-sm font-bold uppercase">é¸æ“‡éŠæˆ²æ¨¡å¼</p>
                <button @click="setMode('left_right')" :class="{'bg-blue-600': mode === 'left_right', 'bg-slate-700': mode !== 'left_right'}" class="w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 transition">
                    ğŸš© å·¦å³è­·æ³• (è½éŸ³è¾¨ä½)
                </button>
                <button @click="setMode('ordering')" :class="{'bg-green-600': mode === 'ordering', 'bg-slate-700': mode !== 'ordering'}" class="w-full text-left px-4 py-3 rounded-lg hover:bg-green-500 transition">
                    ğŸ” é»é¤å¤§è€ƒé©— (çœ‹åœ–èªªè©±)
                </button>
                <button @click="setMode('lottery')" :class="{'bg-purple-600': mode === 'lottery', 'bg-slate-700': mode !== 'lottery'}" class="w-full text-left px-4 py-3 rounded-lg hover:bg-purple-500 transition">
                    ğŸ å¹¸é‹å¤§æŠ½ç
                </button>
            </div>

            <div class="mt-auto border-t border-slate-600 pt-4">
                <p class="text-gray-400 text-sm">å³æ™‚ç‹€æ…‹</p>
                <div class="flex items-center mt-2">
                    <span class="w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                    <span>å­¸ç”Ÿç«¯é€£ç·šä¸­...</span>
                </div>
                <button @click="resetGame" class="mt-4 w-full bg-red-600 py-2 rounded text-sm hover:bg-red-700">é‡ç½®æ‰€æœ‰ç‹€æ…‹</button>
            </div>
        </div>

        <div class="w-3/4 bg-gray-100 flex flex-col items-center justify-center relative p-8">
            
            <div v-if="mode === 'left_right'" class="text-center w-full">
                <h3 class="text-3xl font-bold mb-8 text-slate-600">å·¦å³è­·æ³•ï¼šä½ è½åˆ°äº†å“ªå€‹è©ï¼Ÿ</h3>
                
                <div class="flex justify-center space-x-8 mb-12">
                     <button @click="adminTrigger('left')" class="bg-red-500 text-white w-48 h-48 rounded-3xl text-4xl font-bold shadow-lg hover:bg-red-600 transition transform hover:scale-105 flex flex-col items-center justify-center">
                        <span>ğŸ”´ å·¦</span>
                        <span class="text-lg mt-2 font-normal opacity-80">(Kawiri)</span>
                    </button>
                    <button @click="adminTrigger('right')" class="bg-white text-slate-800 border-4 border-slate-200 w-48 h-48 rounded-3xl text-4xl font-bold shadow-lg hover:bg-gray-50 transition transform hover:scale-105 flex flex-col items-center justify-center">
                        <span>âšª å³</span>
                        <span class="text-lg mt-2 font-normal opacity-80">(Kawanan)</span>
                    </button>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-inner w-full max-w-2xl h-32 flex items-center justify-center space-x-4">
                    <p v-if="!lastClientAction" class="text-gray-400">ç­‰å¾…å­¸ç”Ÿèˆ‰æ——...</p>
                    <div v-else class="animate__animated animate__tada flex flex-col items-center">
                        <span class="text-6xl">{{ lastClientAction === 'left' ? 'ğŸ”´' : 'âšª' }}</span>
                        <span class="text-xl font-bold mt-2 text-slate-700">å­¸ç”Ÿèˆ‰äº†{{ lastClientAction === 'left' ? 'ç´…æ——' : 'ç™½æ——' }}ï¼</span>
                        <span v-if="lastClientAction === currentTarget" class="text-green-600 font-black text-2xl mt-1">âœ… ç­”å°äº†ï¼</span>
                        <span v-else-if="currentTarget" class="text-red-500 font-black text-2xl mt-1">âŒ å“å‘€ï¼</span>
                    </div>
                </div>
            </div>

            <div v-if="mode === 'ordering'" class="text-center w-full h-full flex flex-col items-center justify-center">
                <div v-if="!currentMenuItem" class="text-gray-400 text-2xl">è«‹é¸æ“‡ä¸€é“èœä¸Šæ¶...</div>
                
                <div v-else class="bg-white p-8 rounded-3xl shadow-2xl animate__animated animate__zoomIn max-w-md w-full">
                    <div class="text-9xl mb-6">{{ currentMenuItem.emoji }}</div>
                    <div class="text-4xl font-black text-slate-800 mb-2">{{ currentMenuItem.name }}</div>
                    <div class="text-2xl text-blue-600 font-mono bg-blue-50 py-2 px-4 rounded-lg inline-block">{{ currentMenuItem.pronunciation }}</div>
                </div>

                <div class="mt-12 grid grid-cols-4 gap-4 w-full max-w-3xl">
                    <button v-for="item in menuItems" :key="item.id" @click="showMenu(item)" class="bg-white p-4 rounded-xl shadow hover:shadow-lg transition flex flex-col items-center">
                        <span class="text-4xl">{{ item.emoji }}</span>
                        <span class="font-bold mt-2">{{ item.name }}</span>
                    </button>
                </div>
            </div>

            <div v-if="mode === 'lottery'" class="text-center">
                <h3 class="text-4xl font-black text-purple-600 mb-8">ğŸ å¹¸é‹å¤§æŠ½ç</h3>
                <div class="bg-white w-96 h-64 flex items-center justify-center rounded-3xl shadow-2xl border-8 border-purple-200 mb-8 overflow-hidden relative">
                    <div v-if="isRolling" class="text-8xl animate-spin">ğŸ¡</div>
                    <div v-else class="text-6xl font-bold text-slate-800 animate__animated animate__rubberBand">{{ lotteryResult || 'æº–å‚™é–‹å§‹' }}</div>
                </div>
                <button @click="startLottery" :disabled="isRolling" class="bg-purple-600 text-white px-12 py-4 rounded-full text-2xl font-bold shadow-lg hover:bg-purple-700 disabled:opacity-50 btn-push">
                    {{ isRolling ? 'æŠ½çä¸­...' : 'é–‹å§‹æŠ½ç' }}
                </button>
            </div>

        </div>
    </div>

    <div v-if="view === 'client'" class="h-full bg-slate-100 p-4 flex flex-col">
        
        <div class="bg-white p-4 rounded-2xl shadow-sm mb-4 flex justify-between items-center">
            <div>
                <span class="text-xs text-gray-500 block">ç¾åœ¨æ¨¡å¼</span>
                <span class="font-bold text-lg text-blue-600">
                    {{ mode === 'left_right' ? 'ğŸš© å·¦å³è­·æ³•' : (mode === 'ordering' ? 'ğŸ” é»é¤ä¸­' : 'ğŸ æŠ½çæ™‚åˆ»') }}
                </span>
            </div>
            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
        </div>

        <div v-if="mode === 'left_right'" class="flex-1 flex flex-col space-y-4 justify-center">
            <button @touchstart="clientAction('left')" @click="clientAction('left')" class="flag-btn bg-red-500 text-white shadow-lg flex flex-col items-center justify-center btn-push">
                <span>ğŸ”´</span>
                <span>å·¦é‚Š / æ˜¯</span>
            </button>
            <button @touchstart="clientAction('right')" @click="clientAction('right')" class="flag-btn bg-white text-slate-800 border-4 border-slate-200 shadow-lg flex flex-col items-center justify-center btn-push">
                <span>âšª</span>
                <span>å³é‚Š / å¦</span>
            </button>
        </div>

        <div v-if="mode === 'ordering'" class="flex-1 flex flex-col items-center justify-center">
            <div v-if="currentMenuItem" class="bg-white p-8 rounded-3xl shadow-xl text-center w-full animate__animated animate__fadeInUp">
                <div class="text-8xl mb-4">{{ currentMenuItem.emoji }}</div>
                <p class="text-gray-500 mb-2">è«‹å¤§è²å”¸å‡ºï¼š</p>
                <div class="text-3xl font-black text-blue-600 border-2 border-dashed border-blue-200 p-4 rounded-xl">
                    {{ currentMenuItem.pronunciation }}
                </div>
            </div>
            <div v-else class="text-gray-400 text-center">
                <div class="text-6xl mb-4">ğŸ‘€</div>
                <p>çœ‹è‘—è€é—†çš„å¤§è¢å¹•...</p>
            </div>
        </div>

        <div v-if="mode === 'lottery'" class="flex-1 flex items-center justify-center flex-col">
            <div class="text-9xl mb-4 animate__animated animate__tada">ğŸ</div>
            <h2 class="text-2xl font-bold text-slate-700">ç¥ä½ ä¸­çï¼</h2>
            <p class="text-gray-500 mt-2">è«‹çœ‹å¤§è¢å¹•é–‹ç</p>
        </div>

    </div>

</div>

<script>
    const { createApp, ref, onMounted, watch } = Vue;

    createApp({
        setup() {
            const view = ref('home'); // home, admin, client
            const mode = ref('left_right'); // left_right, ordering, lottery
            const lastClientAction = ref(null);
            const currentTarget = ref(null); // Admin æŒ‡å®šçš„æ­£ç¢ºç­”æ¡ˆ
            
            // é»é¤è³‡æ–™ (æ‚¨å¯ä»¥è‡ªç”±ä¿®æ”¹é€™è£¡)
            const menuItems = ref([
                { id: 1, name: 'ç³–æœ', emoji: 'ğŸ¬', pronunciation: 'Alufu' },
                { id: 2, name: 'é£›é¼ ', emoji: 'ğŸ¿ï¸', pronunciation: 'Paga' },
                { id: 3, name: 'å±±è±¬', emoji: 'ğŸ—', pronunciation: 'Babo' },
                { id: 4, name: 'è¬è¬', emoji: 'ğŸ™', pronunciation: 'Aray' },
            ]);
            const currentMenuItem = ref(null);

            // æŠ½ç
            const isRolling = ref(false);
            const lotteryResult = ref('');
            const prizes = ['é ­ç', 'äºŒç', 'ç³–æœä¸€é¡†', 'å†ä¾†ä¸€æ¬¡', 'éŠ˜è¬æƒ é¡§'];

            // --- æ ¸å¿ƒï¼šä½¿ç”¨ localStorage æ¨¡æ“¬ Socket ---
            const CHANNEL = 'mother-lang-game-data';

            // ç›£è½è³‡æ–™è®Šæ›´ (æ¥æ”¶ç«¯)
            window.addEventListener('storage', (event) => {
                if (event.key === CHANNEL) {
                    const data = JSON.parse(event.newValue);
                    if (!data) return;

                    // å¦‚æœæˆ‘æ˜¯ Clientï¼ŒåŒæ­¥ Admin çš„æ¨¡å¼
                    if (view.value === 'client') {
                        if (data.type === 'MODE_CHANGE') {
                            mode.value = data.payload;
                            // é‡ç½®ç‹€æ…‹
                            currentMenuItem.value = null;
                        }
                        if (data.type === 'MENU_SHOW') {
                            currentMenuItem.value = data.payload;
                        }
                    }

                    // å¦‚æœæˆ‘æ˜¯ Adminï¼Œæ¥æ”¶ Client çš„å‹•ä½œ
                    if (view.value === 'admin') {
                        if (data.type === 'CLIENT_ACTION') {
                            lastClientAction.value = data.payload;
                            // æ’­æ”¾éŸ³æ•ˆ (å¯é¸)
                            // playSound();
                            
                            // 3ç§’å¾Œè‡ªå‹•æ¸…é™¤é¡¯ç¤º
                            setTimeout(() => {
                                if (lastClientAction.value === data.payload) lastClientAction.value = null;
                            }, 3000);
                        }
                    }
                }
            });

            // ç™¼é€è³‡æ–™ (ç™¼é€ç«¯)
            const sendData = (type, payload) => {
                const message = { type, payload, timestamp: new Date().getTime() };
                localStorage.setItem(CHANNEL, JSON.stringify(message));
                
                // æœ¬åœ°ä¹Ÿè¦åŒæ­¥åæ‡‰
                if (type === 'MODE_CHANGE') mode.value = payload;
                if (type === 'MENU_SHOW') currentMenuItem.value = payload;
            };

            // --- Admin åŠŸèƒ½ ---
            const enterRole = (role) => {
                view.value = role;
                // å¦‚æœæ˜¯ Admin é€²ä¾†ï¼Œåˆå§‹åŒ–æ¨¡å¼å»£æ’­
                if (role === 'admin') {
                    sendData('MODE_CHANGE', mode.value);
                }
            };

            const setMode = (newMode) => {
                mode.value = newMode;
                sendData('MODE_CHANGE', newMode);
                // é‡ç½®
                lastClientAction.value = null;
                currentMenuItem.value = null;
                currentTarget.value = null;
            };

            const adminTrigger = (direction) => {
                currentTarget.value = direction;
                // é€™è£¡å¯ä»¥æ’­æ”¾ Admin ç«¯çš„éŸ³æ•ˆ
            };

            const showMenu = (item) => {
                currentMenuItem.value = item;
                sendData('MENU_SHOW', item);
            };

            const startLottery = () => {
                isRolling.value = true;
                lotteryResult.value = '...';
                
                let count = 0;
                const interval = setInterval(() => {
                    lotteryResult.value = prizes[Math.floor(Math.random() * prizes.length)];
                    count++;
                    if (count > 20) {
                        clearInterval(interval);
                        isRolling.value = false;
                        lotteryResult.value = prizes[Math.floor(Math.random() * prizes.length)];
                    }
                }, 100);
            };

            const resetGame = () => {
                lastClientAction.value = null;
                currentTarget.value = null;
                currentMenuItem.value = null;
                sendData('MODE_CHANGE', mode.value); // å¼·åˆ¶åŒæ­¥
            };

            // --- Client åŠŸèƒ½ ---
            const clientAction = (action) => {
                // ç™¼é€å‹•ä½œçµ¦ Admin
                sendData('CLIENT_ACTION', action);
                
                // æ‰‹æ©Ÿéœ‡å‹•å›é¥‹ (å¦‚æœæ”¯æ´)
                if (navigator.vibrate) navigator.vibrate(50);
            };

            return {
                view, mode, enterRole,
                // Admin Data
                lastClientAction, currentTarget, menuItems, currentMenuItem, 
                setMode, adminTrigger, showMenu, 
                // Lottery
                isRolling, lotteryResult, startLottery, resetGame,
                // Client Data
                clientAction
            };
        }
    }).mount('#app');
</script>
</body>
</html>
